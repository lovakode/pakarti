import{r as d,w as M,q as S,S as U,o as g,T as s,c as k,Q as T,ai as j,a as _,_ as z,X as c,V as t,aa as f,u as H,W as O}from"./@vue-R74GAGRy.js";import{u as Q,_ as W}from"./app-DkR6lKKd.js";import{a as X}from"./axios-D8rVyQy1.js";import{t as A,s as G,i as J,v as K,f as P,j as Y,m as Z,g as x,h as ee,n as ae,o as oe,k as te,p as q}from"./element-plus-m-0apcFn.js";import{_ as le}from"./SelectEmployee-CkoOof3v.js";import{a as se,u as re}from"./vue-router-LsEmCaCE.js";import"./dayjs-9DF7GWnL.js";import{u as ne}from"./vue-i18n-ZNZ64Gzf.js";import"./pinia-AHalXmfd.js";import"./js-cookie-Cz0CWeBA.js";import"./@iconify-B_FrOzP8.js";import"./@casl-B-uYYHKL.js";import"./@ucast-BiZkLRnB.js";import"./@vueuse-B1uMN4GC.js";import"./chart.js-B8s4pPcf.js";import"./vue-advanced-cropper-Cc488Mck.js";import"./@tanstack-CrM5e4XN.js";import"./vue3-blocks-tree-BH4O2Ayn.js";import"./vue-BaDTWQb3.js";import"./@unhead-Br2qtGVU.js";import"./unhead-DeLy1NBI.js";import"./hookable-B8xFkYCm.js";import"./@intlify-ChVUvfmF.js";import"./@popperjs-D_chPuIy.js";import"./@element-plus-BklxBE5D.js";import"./lodash-es-D7WVGOfI.js";import"./async-validator-9PlIezaS.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@ctrl-r5W6hzzQ.js";const me={__name:"SelectRole",props:{modelValue:{type:[String,Number],default:""}},emits:["update:modelValue"],setup(B,{emit:l}){const V=l,u=B,b=d([]),i=d(u.modelValue),e=d(!1);M(()=>u.modelValue,r=>{i.value=r});const v=async()=>{try{e.value=!0;const r=await X.get("/settings/permissions");r.status===200&&(b.value=r.data),e.value=!1}catch{}};S(()=>{v()});const $=r=>{i.value=r,V("update:modelValue",r)};return(r,y)=>{const h=A,E=G;return g(),U(E,{modelValue:i.value,"onUpdate:modelValue":y[0]||(y[0]=o=>i.value=o),"value-key":"id",class:"w-100",filterable:"",clearable:"",remote:"",onChange:$,autocomplete:"off",loading:e.value},{default:s(()=>[(g(!0),k(T,null,j(b.value,o=>(g(),U(h,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])}}},ue={class:"content"},ie={class:"content-header"},de={class:"content-title"},pe={class:"md:flex hidden items-center gap-2.5 text-sm font-semibold"},ce={class:"p-4"},ve={class:"p-4"},We={__name:"Form",setup(B){const{t:l}=ne(),{setTitle:V}=Q(),u=se(),b=re(),i=d(`${l("common.create")} ${l("base.user")}`),e=d({id:u.params.id?u.params.id:null,name:"",username:"",email:"",password:"",password_confirmation:"",role:null,image:null}),v=d(null),$=d({name:[{required:!0,message:l("validation.required",{attribute:l("common.name")}),trigger:"blur"}],email:[{required:!0,message:l("validation.required",{attribute:l("common.email")}),trigger:"blur"},{type:"email",message:l("validation.email",{attribute:l("common.email")}),trigger:"blur"}],role:[{required:!0,message:l("validation.required",{attribute:l("base.role")}),trigger:"blur"}],password:[{required:!0,message:l("validation.required",{attribute:l("common.password")}),trigger:"blur"}],password_confirmation:[{required:!0,message:l("validation.required",{attribute:l("common.password_confirmation")}),trigger:"blur"},{validator:(o,a,n)=>{a!==e.value.password?n(new Error(l("validation.password_mismatch"))):n()},trigger:"blur"}]}),r=d(!1),y=async o=>{if(o)try{r.value=!0;const a=await axios.get(`/employee/${o}`);if(a.status===200){const n=a.data.result;e.value.name=n.name,e.value.email=n.email,console.log(n),r.value=!1}}catch(a){console.error(a)}else e.value.name=null,e.value.email=null},h=async()=>{try{r.value=!0;const o=await axios.get(`/settings/user/${u.params.id}`);if(o.status===200){const a=o.data;e.value.id=a.id,e.value.employee_id=a.employee_id,e.value.name=a.name,e.value.email=a.email,e.value.username=a.username,e.value.role=a.roles[0].id,r.value=!1}}catch(o){console.error(o)}},E=async()=>{v.value&&v.value.validate(async o=>{if(o)try{r.value=!0;const a=e.value.id?`/settings/user/${e.value.id}/update`:"/settings/user/store",n=e.value.id?"put":"post";await axios({method:n,url:a,data:e.value}),r.value=!1,q({message:l("message.success_input"),type:"success"}),b.replace({path:"/settings/user"})}catch(a){console.log(a),r.value=!1,q({message:l("message.error_server"),type:"error"})}else q({message:l("message.error_input"),type:"error"})})};return S(()=>{u.params.id&&(i.value=`${l("common.edit")} ${l("base.user")}`,h()),V(i.value)}),(o,a)=>{const n=Y,C=J,p=ae,w=oe,R=ee,L=x,D=te,F=Z,I=P,N=K;return g(),k("div",ue,[_("div",ie,[_("h2",de,c(i.value),1),_("div",pe,[t(C,{separator:"/"},{default:s(()=>[t(n,{to:{path:"/"}},{default:s(()=>[f(c(o.$t("base.dashboard")),1)]),_:1}),t(n,{to:{path:"/settings/system"}},{default:s(()=>[f(c(o.$t("base.setting",2)),1)]),_:1}),t(n,{to:{path:"/settings/user"}},{default:s(()=>[f(c(o.$t("base.user",2)),1)]),_:1}),t(n,null,{default:s(()=>[f(c(H(u).params.id?o.$t("common.edit"):o.$t("common.create")),1)]),_:1})]),_:1})])]),z((g(),U(I,{"body-class":"p-0"},{default:s(()=>[t(F,{model:e.value,rules:$.value,ref_key:"formRef",ref:v,onSubmit:O(E,["prevent"]),"label-position":"top"},{default:s(()=>[_("div",ce,[t(L,{gutter:20},{default:s(()=>[t(R,{md:12},{default:s(()=>[t(p,{label:o.$t("common.image")},{default:s(()=>[t(W,{modelValue:e.value.image,"onUpdate:modelValue":a[0]||(a[0]=m=>e.value.image=m),size:"small"},null,8,["modelValue"])]),_:1},8,["label"]),t(p,{label:o.$t("base.employee"),prop:"employee_id"},{default:s(()=>[t(le,{modelValue:e.value.employee_id,"onUpdate:modelValue":a[1]||(a[1]=m=>e.value.employee_id=m),onChange:y},null,8,["modelValue"])]),_:1},8,["label"]),t(p,{label:o.$t("common.name"),prop:"name"},{default:s(()=>[t(w,{modelValue:e.value.name,"onUpdate:modelValue":a[2]||(a[2]=m=>e.value.name=m),readonly:e.value.employee_id},null,8,["modelValue","readonly"])]),_:1},8,["label"])]),_:1}),t(R,{md:12},{default:s(()=>[t(p,{label:o.$t("common.email"),prop:"email"},{default:s(()=>[t(w,{modelValue:e.value.email,"onUpdate:modelValue":a[3]||(a[3]=m=>e.value.email=m),readonly:e.value.employee_id},null,8,["modelValue","readonly"])]),_:1},8,["label"]),t(p,{label:o.$t("base.role"),prop:"role"},{default:s(()=>[t(me,{modelValue:e.value.role,"onUpdate:modelValue":a[4]||(a[4]=m=>e.value.role=m)},null,8,["modelValue"])]),_:1},8,["label"]),t(p,{label:o.$t("common.password"),prop:"password"},{default:s(()=>[t(w,{modelValue:e.value.password,"onUpdate:modelValue":a[5]||(a[5]=m=>e.value.password=m),type:"password","show-password":""},null,8,["modelValue"])]),_:1},8,["label"]),t(p,{label:o.$t("common.password_confirmation"),prop:"password_confirmation"},{default:s(()=>[t(w,{modelValue:e.value.password_confirmation,"onUpdate:modelValue":a[6]||(a[6]=m=>e.value.password_confirmation=m),type:"password","show-password":""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1})]),_("div",ve,[t(D,{"native-type":"submit",type:"primary"},{default:s(()=>[f(c(o.$t("common.save")),1)]),_:1})])]),_:1},8,["model","rules"])]),_:1})),[[N,r.value]])])}}};export{We as default};
