import{q as ae,r as p,c as oe,a as d,V as e,X as m,T as a,o as le,aa as i,u as s,W as w}from"./@vue-R74GAGRy.js";import{a as S}from"./axios-D8rVyQy1.js";import{I as E}from"./@iconify-B_FrOzP8.js";import{_ as ne}from"./lodash-BJPsjdUP.js";import{u as se}from"./vue-i18n-ZNZ64Gzf.js";import{_ as re}from"./SkeletonTable-BlkTH-8E.js";import{u as me}from"./@tanstack-CrM5e4XN.js";import{u as de,b as ie}from"./app-CP7P-XXU.js";import{_ as ue}from"./SelectDepartment-DgrX5KRk.js";import{i as ce,f as pe,l as _e,j as fe,s as ve,t as ge,o as be,k as ye,u as we,q as $e,r as he,a as Ee,b as Ve,c as ke,y as Ce,m as qe,n as De,z as Se,p as y,D as Be}from"./element-plus-m-0apcFn.js";import"./@intlify-ChVUvfmF.js";import"./pinia-AHalXmfd.js";import"./vue-router-LsEmCaCE.js";import"./js-cookie-Cz0CWeBA.js";import"./@casl-B-uYYHKL.js";import"./@ucast-BiZkLRnB.js";import"./@vueuse-B1uMN4GC.js";import"./chart.js-B8s4pPcf.js";import"./vue-advanced-cropper-Cc488Mck.js";import"./dayjs-9DF7GWnL.js";import"./vue3-blocks-tree-BH4O2Ayn.js";import"./vue-BaDTWQb3.js";import"./@unhead-Br2qtGVU.js";import"./unhead-DeLy1NBI.js";import"./hookable-B8xFkYCm.js";import"./@popperjs-D_chPuIy.js";import"./@element-plus-BklxBE5D.js";import"./lodash-es-D7WVGOfI.js";import"./async-validator-9PlIezaS.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@ctrl-r5W6hzzQ.js";const Ie={class:"content"},Te={class:"content-header"},Fe={class:"mt-auto mb-0"},Me={class:"text-lg font-semibold"},Ue={class:"mt-auto mb-0"},je={class:"flex justify-between items-center p-4"},Le={class:"flex items-center gap-2"},Pe={class:"flex justify-between items-center p-4"},Re={class:"flex items-center gap-2"},ze={class:"flex items-center gap-2"},Ne={class:"text-end"},ht={__name:"Department",setup(He){const{formatDate:F}=ie(),{t:r}=se(),{setTitle:M}=de();ae(()=>{M(r("base.department",2))});const u=p({page:1,limit:25,q:"",tree:!0}),U=p([]),j=t=>{U.value=t},L=async({queryKey:t})=>{const[n,c]=t,g=await S.get("/settings/department",{params:c});return u.value.page=g.data.page,g.data},{data:_,isLoading:$,isError:Ke,error:Oe,refetch:f}=me({queryKey:["departmentList",u.value],queryFn:L,keepPreviousData:!0}),P=ne.debounce(()=>{u.value.page=1,f()},2e3),R=()=>{f()},z=t=>{u.value.page=t,f()},V=p(null),v=p(!1),k=p(""),o=p({id:null,name:null,code:null,parent_id:null}),N=p({name:[{required:!0,message:r("validation.required",{attribute:r("common.name")}),trigger:"blur"}]}),B=p(!1),H=()=>{k.value=`${r("common.create")} ${r("base.department")}`,v.value=!0,o.value.id=null,o.value.name=null,o.value.code=null,o.value.parent_id=null},K=t=>{k.value=`${r("common.edit")} ${r("base.department")}`,v.value=!0,o.value.id=t.id,o.value.name=t.name,o.value.code=t.code,o.value.parent_id=t.parent_id},I=()=>{v.value=!1,o.value.id=null,o.value.name=null,o.value.code=null,o.value.parent_id=null},O=async()=>{V.value&&V.value.validate(async t=>{if(t){const n=Be.service({customClass:"rounded-md",target:document.querySelector("#modalForm")});try{B.value=!0;const c=o.value.id?`/settings/department/${o.value.id}/update`:"/settings/department/store",g=o.value.id?"put":"post";await S({method:g,url:c,data:o.value}),v.value=!1,f(),I(),y({message:r("message.success_save"),type:"success"})}catch{B.value=!1,y({message:r("message.error_server"),type:"error"})}n.close()}else y({message:r("message.error_input"),type:"error"})})},Q=t=>{Se.confirm(r("message.delete_confirm"),r("message.delete_confirm_title"),{confirmButtonText:r("common.ok"),cancelButtonText:r("common.cancel"),type:"warning"}).then(()=>{S.delete(`/settings/department/${t}/delete`).then(()=>{f(),y({type:"success",message:r("message.delete_success")})}).catch(n=>{y({type:"error",message:r("message.delete_cancel")})})}).catch(()=>{y({type:"info",message:r("message.delete_cancel")})})};return(t,n)=>{const c=fe,g=ce,C=ge,W=ve,q=be,h=ye,b=he,T=ke,X=Ve,x=Ee,A=$e,G=Ce,J=we,Y=pe,D=De,Z=qe,ee=_e;return le(),oe("div",Ie,[d("div",Te,[d("div",Fe,[d("div",Me,m(t.$t("base.department",2)),1)]),d("div",Ue,[e(g,{separator:"/"},{default:a(()=>[e(c,{to:{path:"/"}},{default:a(()=>[i(m(t.$t("base.dashboard")),1)]),_:1}),e(c,null,{default:a(()=>[i(m(t.$t("base.setting",2)),1)]),_:1}),e(c,null,{default:a(()=>[i(m(t.$t("base.department",2)),1)]),_:1})]),_:1})])]),e(Y,{"body-class":"!p-0",class:"!rounded-lg !shadow-md"},{default:a(()=>[d("div",je,[e(W,{modelValue:u.value.limit,"onUpdate:modelValue":n[0]||(n[0]=l=>u.value.limit=l),placeholder:t.$t("common.select"),disabled:s($),class:"w-20",onChange:n[1]||(n[1]=l=>s(f)())},{default:a(()=>[e(C,{label:"25",value:"25"}),e(C,{label:"50",value:"50"}),e(C,{label:"100",value:"100"})]),_:1},8,["modelValue","placeholder","disabled"]),d("div",Le,[e(q,{modelValue:u.value.q,"onUpdate:modelValue":n[2]||(n[2]=l=>u.value.q=l),onInput:s(P),clearable:"",disabled:s($)},{prefix:a(()=>[e(s(E),{icon:"mingcute:search-line"})]),_:1},8,["modelValue","onInput","disabled"]),e(h,{type:"primary",disabled:s($),onClick:w(H,["prevent"])},{default:a(()=>[e(s(E),{icon:"mingcute:add-line",class:"me-2"}),i(" "+m(t.$t("common.create")),1)]),_:1},8,["disabled"])])]),e(J,{loading:s($),animated:""},{template:a(()=>[e(re)]),default:a(()=>[e(A,{class:"min-w-full","row-key":"id","default-expand-all":"",data:s(_).data,onSortChange:R,onSelectionChange:j},{default:a(()=>[e(b,{type:"selection",width:"55"}),e(b,{prop:"name",label:t.$t("common.name"),sortable:""},null,8,["label"]),e(b,{prop:"code",label:t.$t("common.code"),sortable:""},{default:a(l=>[d("span",null,m(l.row.code??"-"),1)]),_:1},8,["label"]),e(b,{prop:"employee_count",label:t.$t("base.employee"),sortable:""},{default:a(l=>[i(m(l.row.employee_count),1)]),_:1},8,["label"]),e(b,{label:t.$t("common.created_at")},{default:a(l=>[i(m(s(F)(l.row.created_at)),1)]),_:1},8,["label"]),e(b,{label:t.$t("common.action"),align:"center",width:"150"},{default:a(l=>[e(x,{"popper-class":"dropdown-action",trigger:"click"},{dropdown:a(()=>[e(X,null,{default:a(()=>[e(T,{class:"flex justify-between",onClick:w(te=>K(l.row),["prevent"])},{default:a(()=>[e(s(E),{icon:"mingcute:edit-line",class:"me-2"}),i(" "+m(t.$t("common.edit")),1)]),_:2},1032,["onClick"]),e(T,{class:"flex justify-between",onClick:w(te=>Q(l.row.id),["prevent"])},{default:a(()=>[e(s(E),{icon:"mingcute:delete-2-line",class:"me-2"}),i(" "+m(t.$t("common.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:a(()=>[e(h,{type:"primary"},{default:a(()=>[i(m(t.$t("common.action")),1)]),_:1})]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["data"]),d("div",Pe,[d("div",Re,[d("span",null,m(t.$t("common.table_paginate",{from:s(_).from,to:s(_).to,total:s(_).total})),1)]),d("div",ze,[e(G,{class:"float-end",background:"",layout:"prev, pager, next","page-size":s(_).per_page,total:s(_).total,"current-page":s(_).current_page,onCurrentChange:z},null,8,["page-size","total","current-page"])])])]),_:1},8,["loading"])]),_:1}),e(ee,{id:"modalForm",modelValue:v.value,"onUpdate:modelValue":n[6]||(n[6]=l=>v.value=l),title:k.value,class:"!sm:w-full !w-1/3 rounded-lg","close-on-click-modal":!1,"close-on-press-escape":!1},{default:a(()=>[e(Z,{"label-position":"top",ref_key:"formRef",ref:V,model:o.value,rules:N.value,onSubmit:w(O,["prevent"])},{default:a(()=>[e(D,{label:t.$t("common.name"),prop:"name"},{default:a(()=>[e(q,{modelValue:o.value.name,"onUpdate:modelValue":n[3]||(n[3]=l=>o.value.name=l)},null,8,["modelValue"])]),_:1},8,["label"]),e(D,{label:t.$t("common.code"),prop:"code"},{default:a(()=>[e(q,{modelValue:o.value.code,"onUpdate:modelValue":n[4]||(n[4]=l=>o.value.code=l)},null,8,["modelValue"])]),_:1},8,["label"]),e(D,{label:t.$t("base.parent_department"),prop:"parent_id"},{default:a(()=>[e(ue,{modelValue:o.value.parent_id,"onUpdate:modelValue":n[5]||(n[5]=l=>o.value.parent_id=l)},null,8,["modelValue"])]),_:1},8,["label"]),d("div",Ne,[e(h,{onClick:w(I,["prevent"])},{default:a(()=>[i(m(t.$t("common.cancel")),1)]),_:1}),e(h,{type:"primary","native-type":"submit"},{default:a(()=>[i(m(t.$t("common.save")),1)]),_:1})])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}};export{ht as default};
