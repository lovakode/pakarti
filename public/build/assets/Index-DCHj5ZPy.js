import{r as h,a2 as pe,w as G,M as j,O as l,W as e,a as n,c as U,ai as J,V as X,u as i,U as r,T as p,$ as B,o as g,Q as N,R as D,q as _e,al as fe,Y as ge,ak as be}from"./@vue-BedgDXZT.js";import{a as Q}from"./axios-D8rVyQy1.js";import{I as _}from"./@iconify-BzSLy_Lz.js";import{_ as ve}from"./lodash-G2ORfQRs.js";import{_ as ye}from"./SkeletonTable-CkoHEoRM.js";import{u as we}from"./@tanstack-D5MgbqGz.js";import{u as Z}from"./vue-i18n-3uPOuKlG.js";import{_ as $e,u as he,b as ke}from"./app-ChQKHz3m.js";import{_ as xe,a as Ce}from"./SelectJobPosition-DMRxHTP3.js";import{_ as Ee}from"./SelectDepartment-CcS2AWQw.js";import{_ as Ve}from"./SelectEmployee-CXJ5ABvD.js";import{s as je,k as ee,t as le,u as Ue,m as te,l as Fe,p as S,i as Be,f as De,j as Se,w as Ie,x as Te,g as ze,h as Me,n as Pe,o as Re,y as qe,q as Ae,r as Oe,z as Le,a as Ne,b as Qe,c as He,A as Ke,B as We}from"./element-plus-B3W2dA5h.js";import{u as Ye}from"./@casl-Dl6lt6vV.js";import"./@intlify-ChVUvfmF.js";import"./pinia-BVe78Fnf.js";import"./vue-router-CFFWa3Rv.js";import"./js-cookie-Cz0CWeBA.js";import"./@vueuse-_BfsD77n.js";import"./chart.js-B8s4pPcf.js";import"./vue-advanced-cropper-C5NvVQmq.js";import"./dayjs-BmnIqbSg.js";import"./vue3-blocks-tree-BkKvaGx5.js";import"./vue-BcxTvRm9.js";import"./@unhead-BU3UxbPv.js";import"./unhead-M3i9Ttrl.js";import"./hookable-B8xFkYCm.js";import"./@ucast-BiZkLRnB.js";import"./@popperjs-D_chPuIy.js";import"./@element-plus-DHhqOHwO.js";import"./lodash-es-D7WVGOfI.js";import"./async-validator-9PlIezaS.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@ctrl-r5W6hzzQ.js";const Ge={class:"flex items-center gap-2"},Je={class:"grid grid-cols-2 gap-4 mb-6"},Xe=["onClick"],Ze={class:"flex items-center justify-center w-10 h-10 rounded-lg bg-gray-100 mr-3"},el={class:"format-name flex-1"},ll={class:"format-check"},tl={class:"bg-gray-50 p-4 rounded-lg mb-6"},ol={class:"flex items-center gap-3"},al={class:"font-medium text-gray-900"},nl={class:"mb-6"},sl={class:"flex items-center justify-between mb-4"},rl={class:"flex items-center gap-2"},il={class:"text-lg font-semibold text-gray-800"},cl={class:"flex items-center gap-2"},ml={class:"mb-4"},dl={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3"},ul=["onClick"],pl={class:"flex items-center justify-center w-8 h-8 rounded-lg bg-gray-100 mr-3"},_l={class:"column-name flex-1"},fl={class:"pt-4 border-t border-gray-200"},gl={class:"flex justify-end gap-3"},bl={__name:"ModalExportEmployee",props:{modelValue:{type:Boolean,default:!1},currentFilters:{type:Object,default:()=>({})}},emits:["update:modelValue","exported"],setup(H,{emit:q}){const{t:m}=Z(),k=H,T=q,v=h(k.modelValue),x=h(!1),s=h(),d=pe({format:"excel",useCurrentFilters:!0,columns:["code","name","email","phone","gender","birth_date","department","job_position","grade","status","join_date"]}),z=h([{value:"excel",name:"Excel (.xlsx)",description:"Best for data analysis and calculations",icon:"file-icons:microsoft-excel",iconColor:"text-green-600"},{value:"pdf",name:"PDF",description:"Perfect for reports and printing",icon:"vscode-icons:file-type-pdf2",iconColor:"text-red-600"}]),b=h([{value:"code",label:m("common.code"),icon:"mingcute:hashtag-line"},{value:"name",label:m("common.name"),icon:"mingcute:user-2-line"},{value:"email",label:m("common.email"),icon:"mingcute:mail-line"},{value:"phone",label:m("common.phone"),icon:"mingcute:phone-line"},{value:"gender",label:m("employee.gender"),icon:"mingcute:group-line"},{value:"birth_date",label:m("employee.birth_date"),icon:"mingcute:calendar-line"},{value:"department",label:m("base.department"),icon:"mingcute:building-line"},{value:"job_position",label:m("base.job_position"),icon:"mingcute:briefcase-line"},{value:"grade",label:m("base.grade"),icon:"mingcute:medal-line"},{value:"status",label:m("common.status"),icon:"mingcute:check-circle-line"},{value:"join_date",label:m("employee.join_date"),icon:"mingcute:calendar-add-line"},{value:"exit_date",label:m("employee.exit_date"),icon:"mingcute:exit-door-line"},{value:"ptkp",label:m("employee.ptkp"),icon:"mingcute:textbox-fill"},{value:"address",label:m("common.address"),icon:"mingcute:location-line"},{value:"emergency_contact",label:m("employee.emergency_contact"),icon:"mingcute:phone-call-line"}]);G(()=>k.modelValue,c=>{v.value=c}),G(v,c=>{T("update:modelValue",c)});const C=()=>{v.value=!1},K=()=>{d.columns=b.value.map(c=>c.value)},W=()=>{d.columns=[]},w=c=>{const f=d.columns.indexOf(c);f>-1?d.columns.splice(f,1):d.columns.push(c)},A=()=>d.columns.length===0?(S.warning("Please select at least one column to export"),!1):!0,O=(c,f)=>{const t=window.URL.createObjectURL(new Blob([c.data])),a=document.createElement("a");a.href=t;const $=new Date().toISOString().split("T")[0];a.setAttribute("download",`employee_export_${$}.${f}`),document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(t)},M=async()=>{if(A()){x.value=!0;try{const c={};d.useCurrentFilters&&Object.assign(c,k.currentFilters),c.columns=d.columns.join(",");const f=d.format==="excel"?"/employee/export/excel":"/employee/export/pdf",t=d.format==="excel"?"xlsx":"pdf",a=await Q.get(f,{params:c,responseType:"blob"});O(a,t),S.success("Export completed successfully"),T("exported"),C()}catch(c){console.error("Export error:",c),S.error("Export failed. Please try again.")}finally{x.value=!1}}};return(c,f)=>{const t=je,a=ee,$=le,I=Ue,y=te,P=Fe;return g(),j(P,{modelValue:v.value,"onUpdate:modelValue":f[1]||(f[1]=u=>v.value=u),width:"600px","before-close":C,"close-on-click-modal":!1,class:"export-modal","body-class":"p-0"},{title:l(()=>[n("div",Ge,[e(i(_),{icon:"mingcute:download-line",class:"w-5 h-5",style:{color:"var(--el-color-primary)"}}),n("span",null,r(c.$t("common.export"))+" "+r(c.$t("base.employee",2)),1)])]),footer:l(()=>[n("div",gl,[e(a,{onClick:C,size:"large"},{default:l(()=>[p(r(c.$t("common.cancel")),1)]),_:1}),e(a,{type:"primary",size:"large",loading:x.value,onClick:M,disabled:d.columns.length===0},{default:l(()=>[e(i(_),{icon:"mingcute:download-line",class:"mr-2"}),p(" "+r(c.$t("common.export")),1)]),_:1},8,["loading","disabled"])])]),default:l(()=>[e(y,{ref_key:"formRef",ref:s,model:d,onSubmit:B(M,["prevent"])},{default:l(()=>[n("div",Je,[(g(!0),U(X,null,J(z.value,u=>(g(),U("div",{key:u.value,class:N(["format-card",{active:d.format===u.value}]),onClick:R=>d.format=u.value},[n("div",Ze,[e(i(_),{icon:u.icon,class:N(["w-5 h-5",u.iconColor])},null,8,["icon","class"])]),n("div",el,r(u.name),1),n("div",ll,[d.format===u.value?(g(),j(i(_),{key:0,icon:"mingcute:check-circle-fill",class:"w-5 h-5",style:{color:"var(--el-color-primary)"}})):D("",!0)])],10,Xe))),128))]),n("div",tl,[e(t,{modelValue:d.useCurrentFilters,"onUpdate:modelValue":f[0]||(f[0]=u=>d.useCurrentFilters=u),class:"w-full"},{default:l(()=>[n("div",ol,[e(i(_),{icon:"mingcute:filter-line",class:"w-5 h-5",style:{color:"var(--el-color-primary)"}}),n("div",null,[n("div",al,r(c.$t("common.use_current_filters")),1),f[2]||(f[2]=n("div",{class:"text-sm text-gray-600"},"Apply current table filters to export",-1))])])]),_:1},8,["modelValue"])]),n("div",nl,[n("div",sl,[n("div",rl,[e(i(_),{icon:"mingcute:layout-grid-line",class:"w-5 h-5",style:{color:"var(--el-color-primary)"}}),n("h3",il,r(c.$t("common.columns_to_export")),1)]),n("div",cl,[e(a,{size:"small",text:"",type:"primary",onClick:K},{default:l(()=>[e(i(_),{icon:"mingcute:check-2-line",class:"mr-1"}),p(" "+r(c.$t("common.select_all")),1)]),_:1}),e(a,{size:"small",text:"",onClick:W},{default:l(()=>[e(i(_),{icon:"mingcute:close-line",class:"mr-1"}),p(" "+r(c.$t("common.clear_all")),1)]),_:1})])]),n("div",ml,[e($,{type:"primary",effect:"plain"},{default:l(()=>[p(r(d.columns.length)+" of "+r(b.value.length)+" columns selected ",1)]),_:1})]),n("div",dl,[(g(!0),U(X,null,J(b.value,u=>(g(),U("div",{key:u.value,class:N(["column-card",{selected:d.columns.includes(u.value)}]),onClick:R=>w(u.value)},[n("div",pl,[e(i(_),{icon:u.icon,class:"w-4 h-4 text-gray-500"},null,8,["icon"])]),n("div",_l,r(u.label),1)],10,ul))),128))])]),n("div",fl,[d.columns.length===0?(g(),j(I,{key:0,title:"Please select at least one column to export",type:"warning",closable:!1,"show-icon":""})):(g(),j(I,{key:1,title:`Ready to export ${d.columns.length} columns in ${d.format.toUpperCase()} format`,type:"success",closable:!1,"show-icon":""},null,8,["title"]))])]),_:1},8,["model"])]),_:1},8,["modelValue"])}}},vl=$e(bl,[["__scopeId","data-v-33214c81"]]),yl={class:"content"},wl={class:"content-header"},$l={class:"mt-auto mb-0"},hl={class:"text-lg font-semibold"},kl={class:"mt-auto mb-0"},xl={class:"flex justify-between items-center p-4"},Cl={class:"flex items-center gap-2"},El={key:0,class:"card-filter p-4"},Vl={class:"flex items-center gap-2"},jl={class:"flex"},Ul={class:"my-auto"},Fl={class:""},Bl={class:"font-semibold"},Dl={class:"text-sm"},Sl={key:0,class:"text-xs"},Il={class:"flex justify-between items-center p-4"},Tl={class:"flex items-center gap-2"},zl={class:"flex items-center gap-2"},bt={__name:"Index",setup(H){const{formatDate:q}=ke(),{t:m}=Z(),{can:k}=Ye(),{setTitle:T}=he();_e(()=>{T(m("base.employee",2))});const v=h(!1),x=h(!1),s=h({limit:25,page:1,q:"",sort:null,sortDir:null,name:null,code:null,status:null,dept:null,pst:null,superior:null}),d=()=>{s.value.name=null,s.value.code=null,s.value.status=null,s.value.dept=null,s.value.pst=null,s.value.superior=null,w()},z=async({queryKey:t})=>{const[a,$]=t;return(await Q.get("/employee",{params:$})).data},{data:b,isLoading:C,isError:K,error:W,refetch:w}=we({queryKey:["customerList",s.value],queryFn:z,keepPreviousData:!0});ve.debounce(()=>{s.value.page=1,w()},1e3);const A=t=>{s.value.sort=t.prop,s.value.sortDir=t.order=="descending"?"DESC":"ASC",w()},O=t=>{s.value.page=t,w()},M=t=>{We.confirm(m("message.delete_confirm"),m("message.delete_confirm_title"),{confirmButtonText:m("common.ok"),cancelButtonText:m("common.cancel"),type:"warning"}).then(()=>{Q.delete(`/employee/${t}/delete`).then(()=>{z(),S({type:"success",message:m("message.delete_success")})}).catch(a=>{S({type:"error",message:m("message.delete_cancel")})})}).catch(()=>{S({type:"info",message:m("message.delete_cancel")})})},c=()=>({q:s.value.q,name:s.value.name,code:s.value.code,status:s.value.status,dept:s.value.dept,pst:s.value.pst,superior:s.value.superior}),f=()=>{console.log("Export completed successfully")};return(t,a)=>{const $=Se,I=Be,y=Te,P=Ie,u=ee,R=Re,E=Pe,V=Me,oe=ze,ae=te,ne=Le,F=Oe,se=le,Y=fe("router-link"),L=He,re=Qe,ie=Ne,ce=Ae,me=Ke,de=qe,ue=De;return g(),U("div",yl,[n("div",wl,[n("div",$l,[n("div",hl,r(t.$t("base.employee",2)),1)]),n("div",kl,[e(I,{separator:"/"},{default:l(()=>[e($,{to:{path:"/"}},{default:l(()=>[p(r(t.$t("base.dashboard")),1)]),_:1}),e($,null,{default:l(()=>[p(r(t.$t("base.employee",2)),1)]),_:1})]),_:1})])]),e(ue,{"body-class":"!p-0",class:"!rounded-lg !shadow-md"},{default:l(()=>[n("div",xl,[e(P,{modelValue:s.value.limit,"onUpdate:modelValue":a[0]||(a[0]=o=>s.value.limit=o),placeholder:t.$t("common.select"),disabled:i(C),class:"w-20",onChange:a[1]||(a[1]=o=>i(w)())},{default:l(()=>[e(y,{label:"25",value:"25"}),e(y,{label:"50",value:"50"}),e(y,{label:"100",value:"100"})]),_:1},8,["modelValue","placeholder","disabled"]),n("div",Cl,[e(u,{type:"primary",plain:"",onClick:a[2]||(a[2]=B(o=>x.value=!0,["prevent"]))},{default:l(()=>[e(i(_),{icon:"mingcute:download-line",class:"me-2"}),p(" "+r(t.$t("common.export")),1)]),_:1}),e(u,{type:"primary",disabled:i(C),onClick:a[3]||(a[3]=B(o=>v.value=!v.value,["prevent"])),plain:v.value},{default:l(()=>[e(i(_),{icon:"fluent:filter-24-filled",class:"me-2"}),p(" "+r(t.$t("common.filter")),1)]),_:1},8,["disabled","plain"]),i(k)("create","employee")?(g(),j(u,{key:0,tag:"router-link",type:"primary",to:"/employee/create"},{default:l(()=>[e(i(_),{icon:"mingcute:add-line",class:"me-2"}),p(" "+r(`${t.$t("common.add")} ${t.$t("base.employee")}`),1)]),_:1})):D("",!0)])]),e(ge,{name:"slide-down"},{default:l(()=>[v.value?(g(),U("div",El,[e(ae,{"label-position":"top",onSubmit:B(i(w),["prevent"])},{default:l(()=>[e(oe,{gutter:20},{default:l(()=>[e(V,{md:6},{default:l(()=>[e(E,{label:t.$t("common.code")},{default:l(()=>[e(R,{modelValue:s.value.code,"onUpdate:modelValue":a[4]||(a[4]=o=>s.value.code=o),clearable:""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),e(V,{md:6},{default:l(()=>[e(E,{label:t.$t("common.name")},{default:l(()=>[e(R,{modelValue:s.value.name,"onUpdate:modelValue":a[5]||(a[5]=o=>s.value.name=o),clearable:""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),e(V,{md:6},{default:l(()=>[e(E,{label:t.$t("common.status")},{default:l(()=>[e(P,{modelValue:s.value.status,"onUpdate:modelValue":a[6]||(a[6]=o=>s.value.status=o),clearable:""},{default:l(()=>[e(y,{value:"permanent",label:t.$t("employee.permanent")},null,8,["label"]),e(y,{value:"contract",label:t.$t("employee.contract")},null,8,["label"]),e(y,{value:"resigned",label:t.$t("employee.resigned")},null,8,["label"]),e(y,{value:"retired",label:t.$t("employee.retired")},null,8,["label"]),e(y,{value:"passed_away",label:t.$t("employee.passed_away")},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1}),e(V,{md:6},{default:l(()=>[e(E,{label:t.$t("base.department")},{default:l(()=>[e(Ee,{modelValue:s.value.dept,"onUpdate:modelValue":a[7]||(a[7]=o=>s.value.dept=o)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),e(V,{md:6},{default:l(()=>[e(E,{label:t.$t("base.job_position")},{default:l(()=>[e(xe,{modelValue:s.value.pst,"onUpdate:modelValue":a[8]||(a[8]=o=>s.value.pst=o)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),e(V,{md:6},{default:l(()=>[e(E,{label:t.$t("base.grade")},{default:l(()=>[e(Ce,{modelValue:s.value.grade,"onUpdate:modelValue":a[9]||(a[9]=o=>s.value.grade=o)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),e(V,{md:6},{default:l(()=>[e(E,{label:t.$t("employee.superior")},{default:l(()=>[e(Ve,{modelValue:s.value.superior,"onUpdate:modelValue":a[10]||(a[10]=o=>s.value.superior=o)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),n("div",Vl,[e(u,{type:"primary",onClick:B(d,["prevent"])},{default:l(()=>[e(i(_),{icon:"fluent:arrow-clockwise-24-regular",class:"me-2"}),p(" "+r(t.$t("common.reset")),1)]),_:1})])]),_:1},8,["onSubmit"])])):D("",!0)]),_:1}),e(de,{loading:i(C),animated:""},be({template:l(()=>[e(ye,{rows:15})]),_:2},[i(b)?{name:"default",fn:l(()=>[e(ce,{class:"!w-full","scrollbar-always-on":"",data:i(b).data,onSortChange:A},{default:l(()=>[e(F,{prop:"name",label:t.$t("common.name"),sortable:""},{default:l(o=>[n("div",jl,[e(ne,{class:"!w-10 !h-10 rounded-md me-2",src:o.row.image_path,"preview-src-list":[o.row.image_path],"initial-index":0,"preview-teleported":""},null,8,["src","preview-src-list"]),n("div",Ul,[n("div",Fl,r(o.row.code??"-"),1),n("div",Bl,r(o.row.name),1)])])]),_:1},8,["label"]),e(F,{label:t.$t("employee.gender"),sortable:"",width:"110"},{default:l(o=>[p(r(o.row.gender?t.$t(`employee.${o.row.gender}`):"-"),1)]),_:1},8,["label"]),e(F,{label:t.$t("base.job_position"),width:"200",sortable:""},{default:l(o=>[n("div",null,r(o.row.department?o.row.department.name:"-"),1),n("div",Dl,[p(r(o.row.job_position?o.row.job_position.name:"-")+" ",1),e(se,{size:"small"},{default:l(()=>[p(r(o.row.grade?o.row.grade.name:"-"),1)]),_:2},1024)])]),_:1},8,["label"]),e(F,{prep:"ptkp",label:t.$t("employee.ptkp"),sortable:"",width:"90"},{default:l(o=>[p(r(o.row.ptkp??"-"),1)]),_:1},8,["label"]),e(F,{prep:"status",label:t.$t("common.status"),sortable:"",width:"140"},{default:l(o=>[p(r(o.row.status?t.$t(`employee.${o.row.status}`):"-")+" ",1),["resigned","retired"].includes(o.row.status)?(g(),U("div",Sl,r(i(q)(o.row.exit_date)),1)):D("",!0)]),_:1},8,["label"]),e(F,{label:t.$t("common.action"),align:"center",width:"120"},{default:l(o=>[e(ie,{"popper-class":"dropdown-action",trigger:"click"},{dropdown:l(()=>[e(re,null,{default:l(()=>[e(L,{class:"w-full"},{default:l(()=>[e(Y,{to:`/employee/${o.row.id}`,class:"flex justify-between"},{default:l(()=>[e(i(_),{icon:"mingcute:eye-line",class:"me-2"}),p(" "+r(t.$t("common.view")),1)]),_:2},1032,["to"])]),_:2},1024),i(k)("update","employee")?(g(),j(L,{key:0,class:"w-full"},{default:l(()=>[e(Y,{to:`/employee/${o.row.id}/edit`,class:"flex justify-between"},{default:l(()=>[e(i(_),{icon:"mingcute:edit-line",class:"me-2"}),p(" "+r(t.$t("common.edit")),1)]),_:2},1032,["to"])]),_:2},1024)):D("",!0),i(k)("delete","employee")?(g(),j(L,{key:1,class:"flex justify-between",onClick:B(Ml=>M(o.row.id),["prevent"])},{default:l(()=>[e(i(_),{icon:"mingcute:delete-2-line",class:"me-2"}),p(" "+r(t.$t("common.delete")),1)]),_:2},1032,["onClick"])):D("",!0)]),_:2},1024)]),default:l(()=>[e(u,{type:"primary"},{default:l(()=>[p(r(t.$t("common.action")),1)]),_:1})]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["data"]),n("div",Il,[n("div",Tl,[n("span",null,r(t.$t("common.table_paginate",{from:i(b).from,to:i(b).to,total:i(b).total})),1)]),n("div",zl,[e(me,{class:"float-end",background:"",layout:"prev, pager, next","page-size":i(b).per_page,total:i(b).total,"current-page":s.value.page,onCurrentChange:O},null,8,["page-size","total","current-page"])])])]),key:"0"}:void 0]),1032,["loading"])]),_:1}),e(vl,{modelValue:x.value,"onUpdate:modelValue":a[11]||(a[11]=o=>x.value=o),"current-filters":c(),onExported:f},null,8,["modelValue","current-filters"])])}}};export{bt as default};
