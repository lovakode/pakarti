import{r as d,w as N,q as k,M as U,o as g,O as s,c as C,V as T,ai as O,a as _,P as j,U as c,W as l,T as f,u as z,$ as H}from"./@vue-BedgDXZT.js";import{u as P,c as W}from"./app-ChQKHz3m.js";import{a as A}from"./axios-D8rVyQy1.js";import{x as G,w as J,i as K,v as Q,f as X,j as Y,m as Z,g as x,h as ee,n as ae,o as oe,k as le,p as q}from"./element-plus-B3W2dA5h.js";import{_ as te}from"./SelectEmployee-CXJ5ABvD.js";import{a as se,u as re}from"./vue-router-CFFWa3Rv.js";import"./dayjs-BmnIqbSg.js";import{u as ne}from"./vue-i18n-3uPOuKlG.js";import"./pinia-BVe78Fnf.js";import"./js-cookie-Cz0CWeBA.js";import"./@iconify-BzSLy_Lz.js";import"./@casl-Dl6lt6vV.js";import"./@ucast-BiZkLRnB.js";import"./@vueuse-_BfsD77n.js";import"./chart.js-B8s4pPcf.js";import"./vue-advanced-cropper-C5NvVQmq.js";import"./@tanstack-D5MgbqGz.js";import"./vue3-blocks-tree-BkKvaGx5.js";import"./vue-BcxTvRm9.js";import"./@unhead-BU3UxbPv.js";import"./unhead-M3i9Ttrl.js";import"./hookable-B8xFkYCm.js";import"./@intlify-ChVUvfmF.js";import"./@popperjs-D_chPuIy.js";import"./@element-plus-DHhqOHwO.js";import"./lodash-es-D7WVGOfI.js";import"./async-validator-9PlIezaS.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@ctrl-r5W6hzzQ.js";const me={__name:"SelectRole",props:{modelValue:{type:[String,Number],default:""}},emits:["update:modelValue"],setup(B,{emit:t}){const V=t,u=B,b=d([]),i=d(u.modelValue),e=d(!1);N(()=>u.modelValue,r=>{i.value=r});const v=async()=>{try{e.value=!0;const r=await A.get("/settings/permissions");r.status===200&&(b.value=r.data),e.value=!1}catch{}};k(()=>{v()});const $=r=>{i.value=r,V("update:modelValue",r)};return(r,y)=>{const h=G,E=J;return g(),U(E,{modelValue:i.value,"onUpdate:modelValue":y[0]||(y[0]=o=>i.value=o),"value-key":"id",class:"w-100",filterable:"",clearable:"",remote:"",onChange:$,autocomplete:"off",loading:e.value},{default:s(()=>[(g(!0),C(T,null,O(b.value,o=>(g(),U(h,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])}}},ue={class:"content"},ie={class:"content-header"},de={class:"content-title"},pe={class:"md:flex hidden items-center gap-2.5 text-sm font-semibold"},ce={class:"p-4"},ve={class:"p-4"},We={__name:"Form",setup(B){const{t}=ne(),{setTitle:V}=P(),u=se(),b=re(),i=d(`${t("common.create")} ${t("base.user")}`),e=d({id:u.params.id?u.params.id:null,name:"",username:"",email:"",password:"",password_confirmation:"",role:null,image:null}),v=d(null),$=d({name:[{required:!0,message:t("validation.required",{attribute:t("common.name")}),trigger:"blur"}],email:[{required:!0,message:t("validation.required",{attribute:t("common.email")}),trigger:"blur"},{type:"email",message:t("validation.email",{attribute:t("common.email")}),trigger:"blur"}],role:[{required:!0,message:t("validation.required",{attribute:t("base.role")}),trigger:"blur"}],password:[{required:!0,message:t("validation.required",{attribute:t("common.password")}),trigger:"blur"}],password_confirmation:[{required:!0,message:t("validation.required",{attribute:t("common.password_confirmation")}),trigger:"blur"},{validator:(o,a,n)=>{a!==e.value.password?n(new Error(t("validation.password_mismatch"))):n()},trigger:"blur"}]}),r=d(!1),y=async o=>{if(o)try{r.value=!0;const a=await axios.get(`/employee/${o}`);if(a.status===200){const n=a.data.result;e.value.name=n.name,e.value.email=n.email,console.log(n),r.value=!1}}catch(a){console.error(a)}else e.value.name=null,e.value.email=null},h=async()=>{try{r.value=!0;const o=await axios.get(`/settings/user/${u.params.id}`);if(o.status===200){const a=o.data;e.value.id=a.id,e.value.employee_id=a.employee_id,e.value.name=a.name,e.value.email=a.email,e.value.username=a.username,e.value.role=a.roles[0].id,r.value=!1}}catch(o){console.error(o)}},E=async()=>{v.value&&v.value.validate(async o=>{if(o)try{r.value=!0;const a=e.value.id?`/settings/user/${e.value.id}/update`:"/settings/user/store",n=e.value.id?"put":"post";await axios({method:n,url:a,data:e.value}),r.value=!1,q({message:t("message.success_input"),type:"success"}),b.replace({path:"/settings/user"})}catch(a){console.log(a),r.value=!1,q({message:t("message.error_server"),type:"error"})}else q({message:t("message.error_input"),type:"error"})})};return k(()=>{u.params.id&&(i.value=`${t("common.edit")} ${t("base.user")}`,h()),V(i.value)}),(o,a)=>{const n=Y,S=K,p=ae,w=oe,R=ee,L=x,D=le,F=Z,I=X,M=Q;return g(),C("div",ue,[_("div",ie,[_("h2",de,c(i.value),1),_("div",pe,[l(S,{separator:"/"},{default:s(()=>[l(n,{to:{path:"/"}},{default:s(()=>[f(c(o.$t("base.dashboard")),1)]),_:1}),l(n,{to:{path:"/settings/system"}},{default:s(()=>[f(c(o.$t("base.setting",2)),1)]),_:1}),l(n,{to:{path:"/settings/user"}},{default:s(()=>[f(c(o.$t("base.user",2)),1)]),_:1}),l(n,null,{default:s(()=>[f(c(z(u).params.id?o.$t("common.edit"):o.$t("common.create")),1)]),_:1})]),_:1})])]),j((g(),U(I,{"body-class":"p-0"},{default:s(()=>[l(F,{model:e.value,rules:$.value,ref_key:"formRef",ref:v,onSubmit:H(E,["prevent"]),"label-position":"top"},{default:s(()=>[_("div",ce,[l(L,{gutter:20},{default:s(()=>[l(R,{md:12},{default:s(()=>[l(p,{label:o.$t("common.image")},{default:s(()=>[l(W,{modelValue:e.value.image,"onUpdate:modelValue":a[0]||(a[0]=m=>e.value.image=m),size:"small"},null,8,["modelValue"])]),_:1},8,["label"]),l(p,{label:o.$t("base.employee"),prop:"employee_id"},{default:s(()=>[l(te,{modelValue:e.value.employee_id,"onUpdate:modelValue":a[1]||(a[1]=m=>e.value.employee_id=m),onChange:y},null,8,["modelValue"])]),_:1},8,["label"]),l(p,{label:o.$t("common.name"),prop:"name"},{default:s(()=>[l(w,{modelValue:e.value.name,"onUpdate:modelValue":a[2]||(a[2]=m=>e.value.name=m),readonly:e.value.employee_id},null,8,["modelValue","readonly"])]),_:1},8,["label"])]),_:1}),l(R,{md:12},{default:s(()=>[l(p,{label:o.$t("common.email"),prop:"email"},{default:s(()=>[l(w,{modelValue:e.value.email,"onUpdate:modelValue":a[3]||(a[3]=m=>e.value.email=m),readonly:e.value.employee_id},null,8,["modelValue","readonly"])]),_:1},8,["label"]),l(p,{label:o.$t("base.role"),prop:"role"},{default:s(()=>[l(me,{modelValue:e.value.role,"onUpdate:modelValue":a[4]||(a[4]=m=>e.value.role=m)},null,8,["modelValue"])]),_:1},8,["label"]),l(p,{label:o.$t("common.password"),prop:"password"},{default:s(()=>[l(w,{modelValue:e.value.password,"onUpdate:modelValue":a[5]||(a[5]=m=>e.value.password=m),type:"password","show-password":""},null,8,["modelValue"])]),_:1},8,["label"]),l(p,{label:o.$t("common.password_confirmation"),prop:"password_confirmation"},{default:s(()=>[l(w,{modelValue:e.value.password_confirmation,"onUpdate:modelValue":a[6]||(a[6]=m=>e.value.password_confirmation=m),type:"password","show-password":""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1})]),_("div",ve,[l(D,{"native-type":"submit",type:"primary"},{default:s(()=>[f(c(o.$t("common.save")),1)]),_:1})])]),_:1},8,["model","rules"])]),_:1})),[[M,r.value]])])}}};export{We as default};
