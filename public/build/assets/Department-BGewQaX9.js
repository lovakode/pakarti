import{q as te,r as c,c as oe,a as d,W as e,U as m,O as o,o as ae,T as i,u as r,$ as y}from"./@vue-BedgDXZT.js";import{a as B}from"./axios-D8rVyQy1.js";import{I as E}from"./@iconify-BzSLy_Lz.js";import{_ as le}from"./lodash-G2ORfQRs.js";import{u as ne}from"./vue-i18n-3uPOuKlG.js";import{_ as se}from"./SkeletonTable-CkoHEoRM.js";import{u as re}from"./@tanstack-D5MgbqGz.js";import{u as me}from"./app-ChQKHz3m.js";import"./dayjs-BmnIqbSg.js";import{_ as de}from"./SelectDepartment-CcS2AWQw.js";import{i as ie,f as ue,l as ce,j as pe,w as _e,x as fe,o as ve,k as ge,y as be,q as ye,r as we,a as $e,b as he,c as Ee,A as Ve,m as ke,n as Ce,B as qe,p as g,J as Se}from"./element-plus-B3W2dA5h.js";import"./@intlify-ChVUvfmF.js";import"./pinia-BVe78Fnf.js";import"./vue-router-CFFWa3Rv.js";import"./js-cookie-Cz0CWeBA.js";import"./@casl-Dl6lt6vV.js";import"./@ucast-BiZkLRnB.js";import"./@vueuse-_BfsD77n.js";import"./chart.js-B8s4pPcf.js";import"./vue-advanced-cropper-C5NvVQmq.js";import"./vue3-blocks-tree-BkKvaGx5.js";import"./vue-BcxTvRm9.js";import"./@unhead-BU3UxbPv.js";import"./unhead-M3i9Ttrl.js";import"./hookable-B8xFkYCm.js";import"./@popperjs-D_chPuIy.js";import"./@element-plus-DHhqOHwO.js";import"./lodash-es-D7WVGOfI.js";import"./async-validator-9PlIezaS.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./@ctrl-r5W6hzzQ.js";const Be={class:"content"},De={class:"content-header"},Ie={class:"mt-auto mb-0"},Te={class:"text-lg font-semibold"},Ue={class:"mt-auto mb-0"},Fe={class:"flex justify-between items-center p-4"},Me={class:"flex items-center gap-2"},je={class:"flex justify-between items-center p-4"},Le={class:"flex items-center gap-2"},Pe={class:"flex items-center gap-2"},Re={class:"text-end"},wt={__name:"Department",setup(Ne){const{t:s}=ne(),{setTitle:U}=me();te(()=>{U(s("base.department",2))});const p=c({page:1,limit:25,q:"",tree:!0}),F=c([]),M=t=>{F.value=t},j=async({queryKey:t})=>{const[n,u]=t;return(await B.get("/settings/department",{params:u})).data},{data:_,isLoading:w,isError:xe,error:ze,refetch:f}=re({queryKey:["departmentList",p.value],queryFn:j,keepPreviousData:!0}),L=le.debounce(()=>{p.value.page=1,f()},2e3),P=()=>{f()},R=t=>{p.value.page=t,f()},V=c(null),v=c(!1),k=c(""),a=c({id:null,name:null,code:null,parent_id:null}),N=c({name:[{required:!0,message:s("validation.required",{attribute:s("common.name")}),trigger:"blur"}]}),D=c(!1),x=()=>{k.value=`${s("common.create")} ${s("base.department")}`,v.value=!0,a.value.id=null,a.value.name=null,a.value.code=null,a.value.parent_id=null},z=t=>{k.value=`${s("common.edit")} ${s("base.department")}`,v.value=!0,a.value.id=t.id,a.value.name=t.name,a.value.code=t.code,a.value.parent_id=t.parent_id},I=()=>{v.value=!1,a.value.id=null,a.value.name=null,a.value.code=null,a.value.parent_id=null},O=async()=>{V.value&&V.value.validate(async t=>{if(t){const n=Se.service({customClass:"rounded-md",target:document.querySelector("#modalForm")});try{D.value=!0;const u=a.value.id?`/settings/department/${a.value.id}/update`:"/settings/department/store",$=a.value.id?"put":"post";await B({method:$,url:u,data:a.value}),v.value=!1,f(),I(),g({message:s("message.success_save"),type:"success"})}catch{D.value=!1,g({message:s("message.error_server"),type:"error"})}n.close()}else g({message:s("message.error_input"),type:"error"})})},A=t=>{qe.confirm(s("message.delete_confirm"),s("message.delete_confirm_title"),{confirmButtonText:s("common.ok"),cancelButtonText:s("common.cancel"),type:"warning"}).then(()=>{B.delete(`/settings/department/${t}/delete`).then(()=>{f(),g({type:"success",message:s("message.delete_success")})}).catch(n=>{g({type:"error",message:s("message.delete_cancel")})})}).catch(()=>{g({type:"info",message:s("message.delete_cancel")})})};return(t,n)=>{const u=pe,$=ie,C=fe,H=_e,q=ve,h=ge,b=we,T=Ee,J=he,K=$e,Q=ye,W=Ve,G=be,X=ue,S=Ce,Y=ke,Z=ce;return ae(),oe("div",Be,[d("div",De,[d("div",Ie,[d("div",Te,m(t.$t("base.department",2)),1)]),d("div",Ue,[e($,{separator:"/"},{default:o(()=>[e(u,{to:{path:"/"}},{default:o(()=>[i(m(t.$t("base.dashboard")),1)]),_:1}),e(u,null,{default:o(()=>[i(m(t.$t("base.setting",2)),1)]),_:1}),e(u,null,{default:o(()=>[i(m(t.$t("base.department",2)),1)]),_:1})]),_:1})])]),e(X,{"body-class":"!p-0",class:"!rounded-lg !shadow-md"},{default:o(()=>[d("div",Fe,[e(H,{modelValue:p.value.limit,"onUpdate:modelValue":n[0]||(n[0]=l=>p.value.limit=l),placeholder:t.$t("common.select"),disabled:r(w),class:"w-20",onChange:n[1]||(n[1]=l=>r(f)())},{default:o(()=>[e(C,{label:"25",value:"25"}),e(C,{label:"50",value:"50"}),e(C,{label:"100",value:"100"})]),_:1},8,["modelValue","placeholder","disabled"]),d("div",Me,[e(q,{modelValue:p.value.q,"onUpdate:modelValue":n[2]||(n[2]=l=>p.value.q=l),onInput:r(L),clearable:"",disabled:r(w)},{prefix:o(()=>[e(r(E),{icon:"mingcute:search-line"})]),_:1},8,["modelValue","onInput","disabled"]),e(h,{type:"primary",disabled:r(w),onClick:y(x,["prevent"])},{default:o(()=>[e(r(E),{icon:"mingcute:add-line",class:"me-2"}),i(" "+m(t.$t("common.create")),1)]),_:1},8,["disabled"])])]),e(G,{loading:r(w),animated:""},{template:o(()=>[e(se)]),default:o(()=>[e(Q,{class:"min-w-full","row-key":"id","default-expand-all":"",data:r(_).data,onSortChange:P,onSelectionChange:M},{default:o(()=>[e(b,{type:"selection",width:"55"}),e(b,{prop:"name",label:t.$t("common.name"),sortable:""},null,8,["label"]),e(b,{prop:"code",label:t.$t("common.code"),sortable:""},{default:o(l=>[d("span",null,m(l.row.code??"-"),1)]),_:1},8,["label"]),e(b,{prop:"employee_count",label:t.$t("base.employee"),sortable:""},{default:o(l=>[i(m(l.row.employee_count),1)]),_:1},8,["label"]),e(b,{label:t.$t("common.action"),align:"center",width:"150"},{default:o(l=>[e(K,{"popper-class":"dropdown-action",trigger:"click"},{dropdown:o(()=>[e(J,null,{default:o(()=>[e(T,{class:"flex justify-between",onClick:y(ee=>z(l.row),["prevent"])},{default:o(()=>[e(r(E),{icon:"mingcute:edit-line",class:"me-2"}),i(" "+m(t.$t("common.edit")),1)]),_:2},1032,["onClick"]),e(T,{class:"flex justify-between",onClick:y(ee=>A(l.row.id),["prevent"])},{default:o(()=>[e(r(E),{icon:"mingcute:delete-2-line",class:"me-2"}),i(" "+m(t.$t("common.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:o(()=>[e(h,{type:"primary"},{default:o(()=>[i(m(t.$t("common.action")),1)]),_:1})]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["data"]),d("div",je,[d("div",Le,[d("span",null,m(t.$t("common.table_paginate",{from:r(_).from,to:r(_).to,total:r(_).total})),1)]),d("div",Pe,[e(W,{class:"float-end",background:"",layout:"prev, pager, next","page-size":r(_).per_page,total:r(_).total,"current-page":r(_).current_page,onCurrentChange:R},null,8,["page-size","total","current-page"])])])]),_:1},8,["loading"])]),_:1}),e(Z,{id:"modalForm",modelValue:v.value,"onUpdate:modelValue":n[6]||(n[6]=l=>v.value=l),title:k.value,class:"!sm:w-full !w-1/3 rounded-lg","close-on-click-modal":!1,"close-on-press-escape":!1},{default:o(()=>[e(Y,{"label-position":"top",ref_key:"formRef",ref:V,model:a.value,rules:N.value,onSubmit:y(O,["prevent"])},{default:o(()=>[e(S,{label:t.$t("common.name"),prop:"name"},{default:o(()=>[e(q,{modelValue:a.value.name,"onUpdate:modelValue":n[3]||(n[3]=l=>a.value.name=l)},null,8,["modelValue"])]),_:1},8,["label"]),e(S,{label:t.$t("common.code"),prop:"code"},{default:o(()=>[e(q,{modelValue:a.value.code,"onUpdate:modelValue":n[4]||(n[4]=l=>a.value.code=l)},null,8,["modelValue"])]),_:1},8,["label"]),e(S,{label:t.$t("base.parent_department"),prop:"parent_id"},{default:o(()=>[e(de,{modelValue:a.value.parent_id,"onUpdate:modelValue":n[5]||(n[5]=l=>a.value.parent_id=l)},null,8,["modelValue"])]),_:1},8,["label"]),d("div",Re,[e(h,{onClick:y(I,["prevent"])},{default:o(()=>[i(m(t.$t("common.cancel")),1)]),_:1}),e(h,{type:"primary","native-type":"submit"},{default:o(()=>[i(m(t.$t("common.save")),1)]),_:1})])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}};export{wt as default};
